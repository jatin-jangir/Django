name: Sync issue to Azure DevOps work item (testing)

on:
  issues:
    types:
      [ opened, labeled ]
jobs:
  create_issues:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Add comment to issue
      uses: actions/github-script@v4
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const issue_number = context.payload.pull_request.issue_url.split('/').pop();
          const comment_body = 'thread created.';
          const octokit = require('@octokit/rest')();
          octokit.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: issue_number,
            body: comment_body
          });
    - if: contains(github.event.issue.labels.*.name, 'pager-duty')
      name: custom issues
      env:
        DISCORD_WEBHOOK: ${{ secrets.DISCORD }}
        DISCORD_WEBHOOK_FORUM: ${{ secrets.DISCORD_FORUM }}
        ENABLE_FORUM: true

      uses: jatin-jangir/action-discord@master
      with:
        args: " ${{ github.event.issue.title }} ${{ github.event.issue.html_url }}"
